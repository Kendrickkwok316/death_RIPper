(()=>{var Z=()=>{},De="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function Te(e,t){let i=t.parentNode;if(e.setAttribute("data-kontra",""),i){let s=i.querySelector("[data-kontra]:last-of-type")||t;i.insertBefore(e,s.nextSibling)}else document.body.appendChild(e)}function He(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}var ot={};function $e(e,t){ot[e]=ot[e]||[],ot[e].push(t)}function K(e,...t){(ot[e]||[]).map(i=>i(...t))}var q,dt,te={get(e,t){return t=="_proxy"?!0:Z}};function It(){return q}function ct(){return dt}function re(e,{contextless:t=!1}={}){if(q=document.getElementById(e)||e||document.querySelector("canvas"),t&&(q=q||new Proxy({},te)),!q)throw Error("You must provide a canvas element for the game");return dt=q.getContext("2d")||new Proxy({},te),dt.imageSmoothingEnabled=!1,K("init"),{canvas:q,context:dt}}var rt=class{constructor({spriteSheet:t,frames:i,frameRate:s,loop:n=!0}){this.spriteSheet=t,this.frames=i,this.frameRate=s,this.loop=n;let{width:r,height:h,margin:a=0}=t.frame;this.width=r,this.height=h,this.margin=a,this._f=0,this._a=0}clone(){return new rt(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(!(!this.loop&&this._f==this.frames.length-1))for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:i,width:s=this.width,height:n=this.height,context:r=ct()}){let h=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,a*this.width+(a*2+1)*this.margin,h*this.height+(h*2+1)*this.margin,this.width,this.height,t,i,s,n)}};function We(){return new rt(...arguments)}var ze=/(jpeg|jpg|gif|png|webp)$/,Fe=/(wav|mp3|ogg|aac)$/,he=/^\//,Ne=/\/$/,le=new WeakMap,ae="",Ue="",qe="";function ft(e,t){return new URL(e,t).href}function Gt(e,t){return[e.replace(Ne,""),e?t.replace(he,""):t].filter(i=>i).join("/")}function Ot(e){return e.split(".").pop()}function Yt(e){let t=e.replace("."+Ot(e),"");return t.split("/").length==2?t.replace(he,""):t}function Ke(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}var M={},nt={},V={};function Rt(){window.__k||(window.__k={dm:le,u:ft,d:V,i:M})}function oe(e){ae=e}function je(e){return Rt(),new Promise((t,i)=>{let s,n,r;if(s=Gt(ae,e),M[s])return t(M[s]);n=new Image,n.onload=function(){r=ft(s,window.location.href),M[Yt(e)]=M[s]=M[r]=this,K("assetLoaded",this,e),t(this)},n.onerror=function(){i("Unable to load image "+s)},n.src=s})}function Qe(e){return new Promise((t,i)=>{let s=e,n,r,h,a;if(n=new Audio,r=Ke(n),e=[].concat(e).reduce((d,c)=>d||(r[Ot(c)]?c:null),0),!e)return i("cannot play any of the audio formats provided "+s);if(h=Gt(Ue,e),nt[h])return t(nt[h]);n.addEventListener("canplay",function(){a=ft(h,window.location.href),nt[Yt(e)]=nt[h]=nt[a]=this,K("assetLoaded",this,e),t(this)}),n.onerror=function(){i("Unable to load audio "+h)},n.src=h,n.load()})}function Je(e){Rt();let t,i;return t=Gt(qe,e),V[t]?Promise.resolve(V[t]):fetch(t).then(s=>{if(!s.ok)throw s;return s.clone().json().catch(()=>s.text())}).then(s=>(i=ft(t,window.location.href),typeof s=="object"&&le.set(s,i),V[Yt(e)]=V[t]=V[i]=s,K("assetLoaded",s,e),s))}function et(...e){return Rt(),Promise.all(e.map(t=>{let i=Ot([].concat(t)[0]);return i.match(ze)?je(t):i.match(Fe)?Qe(t):Je(t)}))}function Ve(e,t){let i=Math.sin(t),s=Math.cos(t);return{x:e.x*s-e.y*i,y:e.x*i+e.y*s}}function ee(e,t,i){return Math.min(Math.max(e,i),t)}function p(e,t){return[e,t]=[e,t].map(i=>de(i)),e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function de(e){let{x:t=0,y:i=0,width:s,height:n}=e.world||e;return e.mapwidth&&(s=e.mapwidth,n=e.mapheight),e.anchor&&(t-=s*e.anchor.x,i-=n*e.anchor.y),s<0&&(t+=s,s*=-1),n<0&&(i+=n,n*=-1),{x:t,y:i,width:s,height:n}}var $=class{constructor(t=0,i=0,s={}){this.x=t,this.y=i,s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=i)}add(t){return new $(this.x+t.x,this.y+t.y,this)}subtract(t){return new $(this.x-t.x,this.y-t.y,this)}scale(t){return new $(this.x*t,this.y*t)}normalize(t=this.length()){return new $(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,i,s,n){this._c=!0,this._a=t,this._b=i,this._d=s,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?ee(this._a,this._d,t):t}set y(t){this._y=this._c?ee(this._b,this._e,t):t}};function St(){return new $(...arguments)}var Mt=class{constructor(t){return this.init(t)}init(t={}){this.position=St(),this.velocity=St(),this.acceleration=St(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}},W=class extends Mt{init({width:t=0,height:i=0,context:s=ct(),render:n=this.draw,update:r=this.advance,children:h=[],anchor:a={x:0,y:0},opacity:d=1,rotation:c=0,scaleX:g=1,scaleY:w=1,...l}={}){this._c=[],super.init({width:t,height:i,context:s,anchor:a,opacity:d,rotation:c,scaleX:g,scaleY:w,...l}),this._di=!0,this._uw(),this.addChild(h),this._rf=n,this._uf=r}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(i||s)&&t.translate(i,s),this.context.globalAlpha=this.opacity,this._rf(),(i||s)&&t.translate(-i,-s),this.children.map(r=>r.render&&r.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:s=1,_wr:n=0,_wsx:r=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=r*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=n+this.rotation;let{x:a,y:d}=Ve({x:this._wx,y:this._wy},n);this._wx=a,this._wy=d,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||Z,i._pc()})}removeChild(...t){t.flat().map(i=>{He(this.children,i)&&(i.parent=null,i._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}};var j=class extends W{init({image:t,width:i=t?t.width:void 0,height:s=t?t.height:void 0,...n}={}){super.init({image:t,width:i,height:s,...n})}get animations(){return this._a}set animations(t){let i,s;this._a={};for(i in t)this._a[i]=t[i].clone(),s=s||this._a[i];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}};function G(){return new j(...arguments)}var Ze=/(\d+)(\w+)/;function ti(e){let t=e.match(Ze),i=+t[1],s=t[2];return{size:i,unit:s,computed:i}}var At=class extends W{init({text:t="",textAlign:i="",lineHeight:s=1,font:n=ct().font,...r}={}){t=""+t,super.init({text:t,textAlign:i,lineHeight:s,font:n,...r}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=ti(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let i=this.text.split(" "),s=0,n=2;for(;n<=i.length;n++){let r=i.slice(s,n).join(" ");t.measureText(r).width>this._fw&&(this._s.push(i.slice(s,n-1).join(" ")),s=n-1)}this._s.push(i.slice(s,n).join(" "))}if(!this._s.length&&this.text.includes(`
`)){let i=0;this.text.split(`
`).map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,s=this.context;i=this.textAlign||(s.canvas.dir=="rtl"?"right":"left"),t=i=="right"?this.width:i=="center"?this.width/2|0:0,this._s.map((n,r)=>{s.textBaseline="top",s.textAlign=i,s.fillStyle=this.color,s.font=this.font,s.fillText(n,t,this._fs*this.lineHeight*r)})}};function ut(){return new At(...arguments)}var tt=new WeakMap,Et={},Xt={},ce={0:"left",1:"middle",2:"right"};function fe(e=It()){return tt.get(e)}function ei(e,t){let{x:i,y:s,width:n,height:r}=de(e);do i-=e.sx||0,s-=e.sy||0;while(e=e.parent);let h=t.x-Math.max(i,Math.min(t.x,i+n)),a=t.y-Math.max(s,Math.min(t.y,s+r));return h*h+a*a<t.radius*t.radius}function ii(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let s=t[i];if(s.collidesWithPointer?s.collidesWithPointer(e):ei(s,e))return s}}function I(e,t){return parseFloat(e.getPropertyValue(t))||0}function si(e){let{canvas:t,_s:i}=e,s=t.getBoundingClientRect(),n=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(n[0]),h=parseFloat(n[3]),a=(I(i,"border-left-width")+I(i,"border-right-width"))*r,d=(I(i,"border-top-width")+I(i,"border-bottom-width"))*h,c=(I(i,"padding-left")+I(i,"padding-right"))*r,g=(I(i,"padding-top")+I(i,"padding-bottom"))*h;return{scaleX:(s.width-a-c)/t.width,scaleY:(s.height-d-g)/t.height,offsetX:s.left+(I(i,"border-left-width")+I(i,"padding-left"))*r,offsetY:s.top+(I(i,"border-top-width")+I(i,"padding-top"))*h}}function ie(e){let t=e.button!=null?ce[e.button]:"left";Xt[t]=!0,Bt(e,"onDown")}function kt(e){let t=e.button!=null?ce[e.button]:"left";Xt[t]=!1,Bt(e,"onUp")}function se(e){Bt(e,"onOver")}function ni(e){let t=tt.get(e.target);t._oo=null,Xt={}}function ne(e,t,i){let s=ii(e);s&&s[t]&&s[t](i),Et[t]&&Et[t](i,s),t=="onOver"&&(s!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=s)}function Bt(e,t){e.preventDefault();let i=e.target,s=tt.get(i),{scaleX:n,scaleY:r,offsetX:h,offsetY:a}=si(s);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:c,clientY:g,identifier:w})=>{let l=s.touches[w];l||(l=s.touches[w]={start:{x:(c-h)/n,y:(g-a)/r}},s.touches.length++),l.changed=!1}),Array.from(e.changedTouches).map(({clientX:c,clientY:g,identifier:w})=>{let l=s.touches[w];l.changed=!0,l.x=s.x=(c-h)/n,l.y=s.y=(g-a)/r,ne(s,t,e),K("touchChanged",e,s.touches),t=="onUp"&&(delete s.touches[w],s.touches.length--,s.touches.length||K("touchEnd"))})):(s.x=(e.clientX-h)/n,s.y=(e.clientY-a)/r,ne(s,t,e))}function ue({radius:e=5,canvas:t=It()}={}){let i=tt.get(t);if(!i){let s=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:s},tt.set(t,i)}return t.addEventListener("mousedown",ie),t.addEventListener("touchstart",ie),t.addEventListener("mouseup",kt),t.addEventListener("touchend",kt),t.addEventListener("touchcancel",kt),t.addEventListener("blur",ni),t.addEventListener("mousemove",se),t.addEventListener("touchmove",se),i._t||(i._t=!0,$e("tick",()=>{i._lf.length=0,i._cf.map(s=>{i._lf.push(s)}),i._cf.length=0})),i}function ri(...e){e.flat().map(t=>{let i=t.context?t.context.canvas:It(),s=tt.get(i);if(!s)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){s._cf.push(this),this._r()},s._o.push(t))})}function ge(e,t){let i=e[0].toUpperCase()+e.substr(1);Et["on"+i]=t}var Pt=class extends j{init({padX:t=0,padY:i=0,text:s,disabled:n=!1,onDown:r,onUp:h,...a}={}){super.init({padX:t,padY:i,...a}),this.textNode=ut({...s,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),ri(this),this.addChild(this.textNode),this._od=r||Z,this._ou=h||Z;let d=this._dn=document.createElement("button");d.style=De,d.textContent=this.text,n&&this.disable(),d.addEventListener("focus",()=>this.focus()),d.addEventListener("blur",()=>this.blur()),d.addEventListener("keydown",c=>this._kd(c)),d.addEventListener("keyup",c=>this._ku(c)),Te(d,this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+this.padX*2,i=this.textNode.height+this.padY*2;this.width=Math.max(t,this.width),this.height=Math.max(i,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){(t.code=="Enter"||t.code=="Space")&&this.onDown()}_ku(t){(t.code=="Enter"||t.code=="Space")&&this.onUp()}};function gt(){return new Pt(...arguments)}function hi(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function xe({fps:e=60,clearCanvas:t=!0,update:i=Z,render:s,context:n=ct(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let h=0,a=1e3/e,d=1/e,c=t?hi:Z,g,w,l,f,C,b=!0;r||(window.addEventListener("focus",()=>{b=!0}),window.addEventListener("blur",()=>{b=!1}));function _(){if(w=requestAnimationFrame(_),!!b&&(l=performance.now(),f=l-g,g=l,!(f>1e3))){for(K("tick"),h+=f;h>=a;)C.update(d),h-=a;c(n),C.render()}}return C={update:i,render:s,isStopped:!0,start(){g=performance.now(),this.isStopped=!1,requestAnimationFrame(_)},stop(){this.isStopped=!0,cancelAnimationFrame(w)},_frame:_,set _last(E){g=E}},C}function li(e){if(+e==e)return e;let t=[],i=e.split(".."),s=+i[0],n=+i[1],r=s;if(s<n)for(;r<=n;r++)t.push(r);else for(;r>=n;r--)t.push(r);return t}var Lt=class{constructor({image:t,frameWidth:i,frameHeight:s,frameMargin:n,animations:r}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:s,margin:n},this._f=t.width/i|0,this.createAnimations(r)}createAnimations(t){let i,s;for(s in t){let{frames:n,frameRate:r,loop:h}=t[s];if(i=[],n==null)throw Error("Animation "+s+" must provide a frames property");[].concat(n).map(a=>{i=i.concat(li(a))}),this.animations[s]=We({spriteSheet:this,frames:i,frameRate:r,loop:h})}}};function Dt(){return new Lt(...arguments)}var ai=function(){let e=function(l){return Math.sin(l*6.283184)},t=function(l){return 2*(l%1)-1},i=function(l){return l%1<.5?1:-1},s=function(l){let f=l%1*4;return f<2?f-1:3-f},n=function(l){return .003959503758*2**((l-128)/12)},r=function(l,f,C){let b=h[l.i[0]],_=l.i[1],E=l.i[3]/32,S=h[l.i[4]],Y=l.i[5],m=l.i[8]/32,x=l.i[9],k=l.i[10]*l.i[10]*4,N=l.i[11]*l.i[11]*4,J=l.i[12]*l.i[12]*4,u=1/J,X=-l.i[13]/16,L=l.i[14],Qt=C*2**(2-l.i[15]),B=new Int32Array(k+N+J),y=0,D=0,P,H,A,at,R,st,U;for(P=0,H=0;P<k+N+J;P++,H++)H>=0&&(L=L>>8|(L&255)<<4,H-=Qt,st=n(f+(L&15)+l.i[2]-128),U=n(f+(L&15)+l.i[6]-128)*(1+8e-4*l.i[7])),A=1,P<k?A=P/k:P>=k+N&&(A=(P-k-N)*u,A=(1-A)*3**(X*A)),y+=st*A**E,R=b(y)*_,D+=U*A**m,R+=S(D)*Y,x&&(R+=(2*Math.random()-1)*x),B[P]=80*R*A|0;return B},h=[e,i,t,s],a,d,c,g,w;this.init=function(l){a=l,d=l.endPattern,c=0,g=l.rowLen*l.patternLen*(d+1)*2,w=new Int32Array(g)},this.generate=function(){let l,f,C,b,_,E,S,Y,m,x,k,N,J,u,X,L,Qt,B=new Int32Array(g),y=a.songData[c],D=a.rowLen,P=a.patternLen,H=0,A=0,at,R,st=!1,U=[];if(y)for(b=0;b<=d;++b)for(Y=y.p[b],_=0;_<P;++_){let bt=Y?y.c[Y-1].f[_]:0;bt&&(y.i[bt-1]=y.c[Y-1].f[_+P]||0,bt<17&&(U=[]));let Pe=h[y.i[16]],Le=y.i[17]/512,Ie=2**(y.i[18]-9)/D,Ge=y.i[19],Jt=y.i[20],Oe=y.i[21]*43.23529*3.141592/44100,Ye=1-y.i[22]/255,vt=y.i[23]*1e-5,Re=y.i[24]/32,Xe=y.i[25]/512,Be=6.283184*2**(y.i[26]-9)/D,Vt=y.i[27]/255,Ct=y.i[28]*D&-2;for(X=(b*P+_)*D,E=0;E<4;++E)if(S=Y?y.c[Y-1].n[_+E*P]:0,S){U[S]||(U[S]=r(y,S,D));let Zt=U[S];for(f=0,l=X*2;f<Zt.length;f++,l+=2)B[l]+=Zt[f]}for(f=0;f<D;f++)m=(X+f)*2,u=B[m],u||st?(L=Oe,Ge&&(L*=Pe(Ie*m)*Le+.5),L=1.5*Math.sin(L),H+=L*A,at=Ye*(u-A)-H,A+=L*at,u=Jt==3?A:Jt==1?at:H,vt&&(u*=vt,u=u<1?u>-1?e(u*.25):-1:1,u/=vt),u*=Re,st=u*u>1e-5,x=Math.sin(Be*m)*Xe+.5,R=u*(1-x),u*=x):R=0,m>=Ct&&(R+=B[m-Ct+1]*Vt,u+=B[m-Ct]*Vt),B[m]=R|0,B[m+1]=u|0,w[m]+=R|0,w[m+1]+=u|0}return c++,c/a.numChannels},this.createWave=function(){let l=44,f=l+g*2-8,C=f-36,b=new Uint8Array(l+g*2);b.set([82,73,70,70,f&255,f>>8&255,f>>16&255,f>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,C&255,C>>8&255,C>>16&255,C>>24&255]);for(let _=0,E=l;_<g;++_){let S=w[_];S=S<-32767?-32767:S>32767?32767:S,b[E++]=S&255,b[E++]=S>>8&255}return b}},we=ai;var ye={songData:[{i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],p:[1],c:[{n:[135,137,139,144,144,,,,135,137,139,142,142,,,,135,137,139,140,140,,,,135,137,139,135,135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1};function T(e){return Math.floor(Math.random()*e)}function xt(e){let t,i=0,s=Math.random();for(t in e)if(i+=e[t],s<=i)return t}re();ue();oe("assets/img/");var yt=!1,ht=0,$t=new we;$t.init(ye);var pe,me=document.createElement("audio"),_e=!1,O=parseInt(localStorage.getItem("dsShieldHistory"))?parseInt(localStorage.getItem("dsShieldHistory")):0,Tt=parseInt(localStorage.getItem("dsHighScore"))?parseInt(localStorage.getItem("dsHighScore")):0,oi=setInterval(function(){_e&&(console.log("BGM ready"),pe=$t.createWave(),me.src=URL.createObjectURL(new Blob([pe],{type:"audio/wav"})),me.loop=!0,clearInterval(oi)),_e=$t.generate()>=1}),Ci=G({x:300,y:150,anchor:{x:.5,y:.5},height:20,width:300}),di=gt({x:320,y:350,anchor:{x:.5,y:.5},text:{text:"Start Game",color:"white",font:"24px sans-serif",anchor:{x:.5,y:.5}},padX:20,padY:10,render(){this.focused&&(this.context.setLineDash([8,10]),this.context.lineWidth=3,this.context.strokeStyle="red",this.context.strokeRect(0,0,this.width,this.height)),this.pressed?(this.textNode.color="yellow",Ee(),console.log("SAS"),ht=1,this.pressed=!1):this.hovered?this.textNode.color="red":this.textNode.color="white"}}),ci=gt({x:300,y:150,anchor:{x:.5,y:.5},text:{text:"You are sent back to hell",color:"red",font:"30px sans-serif",anchor:{x:.5,y:.5}},padX:20,padY:10}),be=ut({text:"",font:"18px Aerial",color:"black",x:300,y:250,anchor:{x:.5,y:.5},textAlign:"center"}),Se=gt({x:300,y:350,anchor:{x:.5,y:.5},padX:10,padY:10,onDown(){ht=0,console.log("RE")}});et("replayBut.png").then(()=>{Se.image=M.replayBut});var z=G({x:5,y:5,anchor:{x:0,y:0},height:20,width:300,color:"Aqua"}),wt=0,ke=[];et("shield.png").then(()=>{for(let e=0;e<6;e++){let t=G({x:5+e*20,y:30,anchor:{x:0,y:0},height:15,width:15,image:M.shield});ke.push(t)}});var Me=G({x:0,y:50,anchor:{x:0,y:0},height:480,width:640});et("ground.png").then(()=>{Me.image=M.ground});et("tree.png").then(()=>{});var ve,Wt=new Image;Wt.src="assets/img/death.png";Wt.onload=function(){ve=Dt({image:Wt,frameWidth:20,frameHeight:20,animations:{strike:{frames:"0..2",frameRate:9}}}),o=new mt({x:400,y:320,width:20,height:20,anchor:{x:.5,y:.5},shield:Math.floor(O/20)+1,point:0,animations:ve.animations})};var Ae,zt=new Image;zt.src="assets/img/human.png";zt.onload=function(){Ae=Dt({image:zt,frameWidth:20,frameHeight:20,animations:{die:{frames:"0..2",frameRate:60}}})};var Ft=class extends W{constructor(t){t.anchor={x:0,y:0},t.color="#CD853F",super(t)}draw(){this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height)}},it=[],fi=[[0,50,10,295],[0,50,215,10],[0,520,10,295],[0,315,215,10],[345,50,10,295],[630,50,215,10],[345,520,10,295],[630,315,215,10]];fi.forEach(e=>{it.push(new Ft({x:e[0],y:e[1],height:e[2],width:e[3]}))});var Nt=class extends W{constructor(t){super(t)}},lt=[],ui=[[295,50,10,50,320,490],[0,265,50,10,600,290],[295,520,10,50,320,90],[630,265,50,10,40,290]];ui.forEach(e=>{lt.push(new Nt({x:e[0],y:e[1],height:e[2],width:e[3],anchor:{x:0,y:0},sx:e[4],sy:e[5]}))});var mt=class extends j{constructor(t){super(t)}draw(){super.draw()}},o,_t;et("pointer.png").then(()=>{_t=new mt({x:400,y:320,width:10,height:10,anchor:{x:.5,y:.5},image:M.pointer})});var Ut=class extends W{constructor(t){switch(super(t),T(3)){case 0:let s={x:-t.width/2,y:-t.height/2},n={x:t.width/2-25,y:-t.height/2},r={x:-t.width/2,y:t.height/2-25},h=null,a=null,d=T(4);switch(d){case 0:h=s,a=r;break;case 1:h=n,a=r;break;case 2:h=n,a=s;break;case 3:h=s,a=s;break;default:console.log("Some error occurred")}for(let x=0;x<5;x++){let k=G({x:h.x,y:h.y+x*25,width:25,height:25,anchor:{x:0,y:0},image:M.tree});this.addChild(k)}for(let x=0;x<5;x++){let k=G({x:a.x+x*25,y:a.y,width:25,height:25,anchor:{x:0,y:0},image:M.tree});this.addChild(k)}let c={x:t.x-t.width/2,y:t.y-t.height/2},g={x:t.x+t.width/2,y:t.y-t.height/2},w={x:t.x-t.width/2,y:t.y+t.height/2},l={x:t.x+t.width/2,y:t.y+t.height/2};switch(d){case 0:this.lines=[{pt1:c,pt2:w},{pt1:w,pt2:l}];break;case 1:this.lines=[{pt1:g,pt2:l},{pt1:w,pt2:l}];break;case 2:this.lines=[{pt1:c,pt2:g},{pt1:g,pt2:l}];break;case 3:this.lines=[{pt1:c,pt2:w},{pt1:c,pt2:g}];break;default:console.log("Some error occurred")}break;case 1:let f={x:-t.width/2,y:-25/2},C={x:-25/2,y:-t.width/2};for(let x=0;x<5;x++){let k=G({x:f.x+x*25,y:f.y,width:25,height:25,anchor:{x:0,y:0},image:M.tree});this.addChild(k)}for(let x=0;x<5;x++){let k=G({x:C.x,y:C.y+x*25,width:25,height:25,anchor:{x:0,y:0},image:M.tree});this.addChild(k)}let b={x:t.x,y:t.y-t.height/2},_={x:t.x,y:t.y+t.height/2},E={x:t.x-t.width/2,y:t.y},S={x:t.x+t.width/2,y:t.y};this.lines=[{pt1:b,pt2:_},{pt1:E,pt2:S}];break;case 2:let Y=T(2),m=T(5);switch(Y){case 0:for(let u=0;u<5;u++){let X=G({x:-t.width/2+u*25,y:(m-2)*25-12.5,width:25,height:25,anchor:{x:0,y:0},image:M.tree});this.addChild(X)}let x={x:t.x-t.width/2,y:t.y+(m-2)*25},k={x:t.x+t.width/2,y:t.y+(m-2)*25};this.lines=[{pt1:x,pt2:k}];break;case 1:for(let u=0;u<5;u++){let X=G({x:(m-2)*25-12.5,y:-t.height/2+u*25,width:25,height:25,anchor:{x:0,y:0},image:M.tree});this.addChild(X)}let N={x:t.x+(m-2)*25,y:t.y-t.height/2},J={x:t.x+(m-2)*25,y:t.y+t.height/2};this.lines=[{pt1:N,pt2:J}];break;default:console.log("Some line error occurred")}break;default:console.log("Some type error occurred")}}cast(t,i){for(let s of this.lines){let n=s.pt1.x,r=s.pt1.y,h=s.pt2.x,a=s.pt2.y,d=t.x,c=t.y,g=i.x,w=i.y,l=(n-h)*(c-w)-(r-a)*(d-g);if(l==0)continue;let f=((n-d)*(c-w)-(r-c)*(d-g))/l,C=-((n-h)*(r-c)-(r-a)*(n-d))/l;if(f>0&&f<1&&C>0)return!0}return!1}},qt=class extends j{constructor(t){super(t),this.lifeCount=(10+T(5))*60,this.state=3,this.repelX=0,this.repelY=0,this.lCounter=ut({text:"",font:"18px Aerial",color:"white",x:0,y:0,anchor:{x:.5,y:.5},textAlign:"center"})}check(){let t=!1;for(let i of F)if(i.cast(this,o)&&i.cast(o,this)){t=!0;break}if(!t){let[i,s]=pt(this,o,1),n=!1;for(let h of F)if(this.x-=i,p(this,h)){for(let a of h.children)if(p(this,a)){this.x+=i,n=!0;break}}else this.x+=i;let r=!1;for(let h of F)if(this.y-=s,p(this,h)){for(let a of h.children)if(p(this,a)){this.y+=s,r=!0;break}}else this.y+=s;for(let h of it)if(this.x-=i,p(this,h)){this.x+=i,n=!0;break}else this.x+=i;for(let h of it)if(this.y-=s,p(this,h)){this.y+=s,r=!0;break}else this.y+=s;for(let h of lt)if(this.x-=i,p(this,h)){this.x+=i,n=!0;break}else this.x+=i;for(let h of lt)if(this.y-=s,p(this,h)){this.y+=s,r=!0;break}else this.y+=s;for(let h of v)if(h.indx!=this.indx)if(this.x-=i,p(this,h)&&h.state!=0){this.x+=i,n=!0;break}else this.x+=i;for(let h of v)if(h.indx!=this.indx)if(this.y-=s,p(this,h)&&h.state!=0){this.y+=s,r=!0;break}else this.y+=s;n||(this.x-=i),r||(this.y-=s)}}stateChange(){if(Math.floor(this.lifeCount/60)<11)return Math.floor(this.lifeCount/60)<1?(this.state==1&&this.update(),this.state=0):Math.floor(this.lifeCount/60)<6?this.state==2&&(this.update(),this.state=1):this.state=2,!0}chase(){if(this.repelX||this.repelY){let t={x:this.repelX,y:this.repelY},[i,s]=pt(this,t,2);this.x!=this.repelX||this.y!=this.repelY?(this.x+=i,this.y+=s):(this.repelX=0,this.repelY=0)}else{let t={x:o.x,y:o.y},[i,s]=pt(this,t,2);(this.x!=t.x||this.y!=t.y)&&(this.x+=i,this.y+=s),p(this,o)&&(o.shield?(this.repelX=this.x-i*40,this.repelY=this.y-s*40,o.shield-=1,o.shield==0&&(o.opacity=.4)):(yt=!0,console.log("Loser")))}}draw(){super.draw()}},gi=[[100,150],[115,440],[335,165],[320,390],[540,140],[515,350]],F=[],v=[];function Ee(){F.length=0,v.length=0,gi.forEach(i=>{F.push(new Ut({x:i[0],y:i[1],width:125,height:125,anchor:{x:.5,y:.5}}))});let e={x:0,y:0},t=0;for(;t<5;){let i={x:0,y:0},s=!0;if(e.x<=320){let r=Math.floor((620-e.x)/4);i.x=e.x+xt({4:.4,3:.3,2:.2,1:.1})*r-T(r)}else{let r=Math.floor((e.x-20)/4);i.x=e.x-xt({4:.4,3:.3,2:.2,1:.1})*r+T(r)}if(e.y<=265){let r=Math.floor((460-e.y)/4);i.y=e.y+xt({4:.4,3:.3,2:.2,1:.1})*r-T(r)}else{let r=Math.floor((e.y-20)/4);i.y=e.y-xt({4:.4,3:.3,2:.2,1:.1})*r+T(r)}e.x*=t,e.y*=t,e.x+=i.x,e.y+=i.y,e.x/=t+1,e.y/=t+1;let n=new qt({x:i.x,y:i.y+50,width:20,height:20,anchor:{x:.5,y:.5},indx:t,animations:Ae.animations});if(p(n,o)&&(s=!1),s){for(let r of F)if(p(n,r)){for(let h of r.children)if(p(n,h)){s=!1;break}}}if(s){for(let r of it)if(p(n,r)){s=!1;break}}if(s){for(let r of lt)if(p(n,r)){s=!1;break}}s&&(v.push(n),t+=1,console.log(e.x,e.y),console.log(n.x,n.y))}}function pt(e,t,i){let s=t.y-e.y;s>0?s=s>=i?i:s:s<0&&(s=s<=i?-i:s);let n=t.x-e.x;return n>0?n=n>=i?i:n:n<0&&(n=n<=i?-i:n),[Math.floor(n),Math.floor(s)]}var Kt=0,jt=0,Q=!1;ge("down",function(e,t){ht==1&&(Q=!0,Kt=Ce.x,jt=Ce.y,_t.x=Kt,_t.y=jt)});var Ht=0,Ce=fe(),xi=xe({update:function(){if(Q){let e={x:Kt,y:jt},[t,i]=pt(o,e,3),s=!1;o.x!=e.x||o.y!=e.y?(o.x+=t,o.y+=i):Q=!1;for(let n of F)if(p(o,n)){for(let r of n.children)if(p(o,r)){s=!0;break}}for(let n of it)if(p(o,n)){s=!0;break}for(let n=v.length-1;n>=0;n--)p(o,v[n])&&(v[n].stateChange()?v[n].state&&(o.point+=1,o.point%5==0&&(z.width+=200,z.width=z.width>600?600:z.width),v.splice(n,1),Ht=20):s=!0);yt&&(ht=2,v.length=0,o.x=400,o.y=320,(O<100||!O)&&(O+o.point<100?(Math.floor((O+o.point)/20)-Math.floor(O/20)&&console.log("New shield"),O=O+o.point):(console.log("New shield"),O=100),localStorage.setItem("dsShieldHistory",O)),o.shield=Math.floor(O/20)+1,o.opacity=1,be.text="Score: "+String(o.point),(o.point>Tt||!Tt)&&(console.log("New High Score"),Tt=o.point,localStorage.setItem("dsHighScore",o.point)),o.point=0,z.width=300,wt=0,yt=!1,Q=!1);for(let n of lt)if(p(o,n)){console.log("Exited"),o.x=n.sx,o.y=n.sy,Q=!1,Ee();break}s&&(Q=!1,o.x-=t,o.y-=i)}Ht&&(o.update(),Ht-=1);for(let e=v.length-1;e>=0;e--)v[e].stateChange()&&(v[e].state?v[e].check():v[e].chase()),v[e].lifeCount>0&&(v[e].lifeCount-=1)},render:function(){switch(ht){case 0:di.render();break;case 1:Me.render(),wt<=2?wt++:(wt=0,z.width>0?z.width-=1:yt=!0),z.render();for(let e=1;e<=o.shield;e++)ke[e-1].render();for(let e of it)e.render();for(let e of F)e.render();for(let e of v)e.render(),e.state<3&&(e.lCounter.x=e.x+15,e.lCounter.y=e.y-15,e.lCounter.text=Math.floor(e.lifeCount/60),e.lCounter.render());Q&&_t.render(),o.render();break;case 2:ci.render(),Se.render(),be.render();break;default:console.log("Error")}}});xi.start();})();
