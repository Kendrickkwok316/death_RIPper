(()=>{var Z=()=>{},Ke="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function je(e,t){let i=t.parentNode;if(e.setAttribute("data-kontra",""),i){let s=i.querySelector("[data-kontra]:last-of-type")||t;i.insertBefore(e,s.nextSibling)}else document.body.appendChild(e)}function Qe(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}var ct={};function Je(e,t){ct[e]=ct[e]||[],ct[e].push(t)}function K(e,...t){(ct[e]||[]).map(i=>i(...t))}var q,ft,re={get(e,t){return t=="_proxy"?!0:Z}};function Yt(){return q}function ut(){return ft}function de(e,{contextless:t=!1}={}){if(q=document.getElementById(e)||e||document.querySelector("canvas"),t&&(q=q||new Proxy({},re)),!q)throw Error("You must provide a canvas element for the game");return ft=q.getContext("2d")||new Proxy({},re),ft.imageSmoothingEnabled=!1,K("init"),{canvas:q,context:ft}}var ht=class{constructor({spriteSheet:t,frames:i,frameRate:s,loop:n=!0}){this.spriteSheet=t,this.frames=i,this.frameRate=s,this.loop=n;let{width:r,height:h,margin:a=0}=t.frame;this.width=r,this.height=h,this.margin=a,this._f=0,this._a=0}clone(){return new ht(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(!(!this.loop&&this._f==this.frames.length-1))for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:i,width:s=this.width,height:n=this.height,context:r=ut()}){let h=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,a*this.width+(a*2+1)*this.margin,h*this.height+(h*2+1)*this.margin,this.width,this.height,t,i,s,n)}};function Ve(){return new ht(...arguments)}var Ze=/(jpeg|jpg|gif|png|webp)$/,ti=/(wav|mp3|ogg|aac)$/,ce=/^\//,ei=/\/$/,fe=new WeakMap,ue="",ii="",si="";function gt(e,t){return new URL(e,t).href}function Ot(e,t){return[e.replace(ei,""),e?t.replace(ce,""):t].filter(i=>i).join("/")}function Gt(e){return e.split(".").pop()}function Bt(e){let t=e.replace("."+Gt(e),"");return t.split("/").length==2?t.replace(ce,""):t}function ni(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}var A={},rt={},V={};function Xt(){window.__k||(window.__k={dm:fe,u:gt,d:V,i:A})}function ge(e){ue=e}function ri(e){return Xt(),new Promise((t,i)=>{let s,n,r;if(s=Ot(ue,e),A[s])return t(A[s]);n=new Image,n.onload=function(){r=gt(s,window.location.href),A[Bt(e)]=A[s]=A[r]=this,K("assetLoaded",this,e),t(this)},n.onerror=function(){i("Unable to load image "+s)},n.src=s})}function hi(e){return new Promise((t,i)=>{let s=e,n,r,h,a;if(n=new Audio,r=ni(n),e=[].concat(e).reduce((d,c)=>d||(r[Gt(c)]?c:null),0),!e)return i("cannot play any of the audio formats provided "+s);if(h=Ot(ii,e),rt[h])return t(rt[h]);n.addEventListener("canplay",function(){a=gt(h,window.location.href),rt[Bt(e)]=rt[h]=rt[a]=this,K("assetLoaded",this,e),t(this)}),n.onerror=function(){i("Unable to load audio "+h)},n.src=h,n.load()})}function li(e){Xt();let t,i;return t=Ot(si,e),V[t]?Promise.resolve(V[t]):fetch(t).then(s=>{if(!s.ok)throw s;return s.clone().json().catch(()=>s.text())}).then(s=>(i=gt(t,window.location.href),typeof s=="object"&&fe.set(s,i),V[Bt(e)]=V[t]=V[i]=s,K("assetLoaded",s,e),s))}function et(...e){return Xt(),Promise.all(e.map(t=>{let i=Gt([].concat(t)[0]);return i.match(Ze)?ri(t):i.match(ti)?hi(t):li(t)}))}function ai(e,t){let i=Math.sin(t),s=Math.cos(t);return{x:e.x*s-e.y*i,y:e.x*i+e.y*s}}function he(e,t,i){return Math.min(Math.max(e,i),t)}function p(e,t){return[e,t]=[e,t].map(i=>ye(i)),e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function ye(e){let{x:t=0,y:i=0,width:s,height:n}=e.world||e;return e.mapwidth&&(s=e.mapwidth,n=e.mapheight),e.anchor&&(t-=s*e.anchor.x,i-=n*e.anchor.y),s<0&&(t+=s,s*=-1),n<0&&(i+=n,n*=-1),{x:t,y:i,width:s,height:n}}var W=class{constructor(t=0,i=0,s={}){this.x=t,this.y=i,s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=i)}add(t){return new W(this.x+t.x,this.y+t.y,this)}subtract(t){return new W(this.x-t.x,this.y-t.y,this)}scale(t){return new W(this.x*t,this.y*t)}normalize(t=this.length()){return new W(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,i,s,n){this._c=!0,this._a=t,this._b=i,this._d=s,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?he(this._a,this._d,t):t}set y(t){this._y=this._c?he(this._b,this._e,t):t}};function At(){return new W(...arguments)}var Et=class{constructor(t){return this.init(t)}init(t={}){this.position=At(),this.velocity=At(),this.acceleration=At(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}},U=class extends Et{init({width:t=0,height:i=0,context:s=ut(),render:n=this.draw,update:r=this.advance,children:h=[],anchor:a={x:0,y:0},opacity:d=1,rotation:c=0,scaleX:g=1,scaleY:w=1,...l}={}){this._c=[],super.init({width:t,height:i,context:s,anchor:a,opacity:d,rotation:c,scaleX:g,scaleY:w,...l}),this._di=!0,this._uw(),this.addChild(h),this._rf=n,this._uf=r}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(i||s)&&t.translate(i,s),this.context.globalAlpha=this.opacity,this._rf(),(i||s)&&t.translate(-i,-s),this.children.map(r=>r.render&&r.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:s=1,_wr:n=0,_wsx:r=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=r*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=n+this.rotation;let{x:a,y:d}=ai({x:this._wx,y:this._wy},n);this._wx=a,this._wy=d,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||Z,i._pc()})}removeChild(...t){t.flat().map(i=>{Qe(this.children,i)&&(i.parent=null,i._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}};var j=class extends U{init({image:t,width:i=t?t.width:void 0,height:s=t?t.height:void 0,...n}={}){super.init({image:t,width:i,height:s,...n})}get animations(){return this._a}set animations(t){let i,s;this._a={};for(i in t)this._a[i]=t[i].clone(),s=s||this._a[i];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}};function G(){return new j(...arguments)}var oi=/(\d+)(\w+)/;function di(e){let t=e.match(oi),i=+t[1],s=t[2];return{size:i,unit:s,computed:i}}var Pt=class extends U{init({text:t="",textAlign:i="",lineHeight:s=1,font:n=ut().font,...r}={}){t=""+t,super.init({text:t,textAlign:i,lineHeight:s,font:n,...r}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=di(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let i=this.text.split(" "),s=0,n=2;for(;n<=i.length;n++){let r=i.slice(s,n).join(" ");t.measureText(r).width>this._fw&&(this._s.push(i.slice(s,n-1).join(" ")),s=n-1)}this._s.push(i.slice(s,n).join(" "))}if(!this._s.length&&this.text.includes(`
`)){let i=0;this.text.split(`
`).map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,s=this.context;i=this.textAlign||(s.canvas.dir=="rtl"?"right":"left"),t=i=="right"?this.width:i=="center"?this.width/2|0:0,this._s.map((n,r)=>{s.textBaseline="top",s.textAlign=i,s.fillStyle=this.color,s.font=this.font,s.fillText(n,t,this._fs*this.lineHeight*r)})}};function it(){return new Pt(...arguments)}var tt=new WeakMap,Lt={},Tt={},we={0:"left",1:"middle",2:"right"};function xe(e=Yt()){return tt.get(e)}function ci(e,t){let{x:i,y:s,width:n,height:r}=ye(e);do i-=e.sx||0,s-=e.sy||0;while(e=e.parent);let h=t.x-Math.max(i,Math.min(t.x,i+n)),a=t.y-Math.max(s,Math.min(t.y,s+r));return h*h+a*a<t.radius*t.radius}function fi(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let s=t[i];if(s.collidesWithPointer?s.collidesWithPointer(e):ci(s,e))return s}}function I(e,t){return parseFloat(e.getPropertyValue(t))||0}function ui(e){let{canvas:t,_s:i}=e,s=t.getBoundingClientRect(),n=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(n[0]),h=parseFloat(n[3]),a=(I(i,"border-left-width")+I(i,"border-right-width"))*r,d=(I(i,"border-top-width")+I(i,"border-bottom-width"))*h,c=(I(i,"padding-left")+I(i,"padding-right"))*r,g=(I(i,"padding-top")+I(i,"padding-bottom"))*h;return{scaleX:(s.width-a-c)/t.width,scaleY:(s.height-d-g)/t.height,offsetX:s.left+(I(i,"border-left-width")+I(i,"padding-left"))*r,offsetY:s.top+(I(i,"border-top-width")+I(i,"padding-top"))*h}}function le(e){let t=e.button!=null?we[e.button]:"left";Tt[t]=!0,Dt(e,"onDown")}function Mt(e){let t=e.button!=null?we[e.button]:"left";Tt[t]=!1,Dt(e,"onUp")}function ae(e){Dt(e,"onOver")}function gi(e){let t=tt.get(e.target);t._oo=null,Tt={}}function oe(e,t,i){let s=fi(e);s&&s[t]&&s[t](i),Lt[t]&&Lt[t](i,s),t=="onOver"&&(s!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=s)}function Dt(e,t){e.preventDefault();let i=e.target,s=tt.get(i),{scaleX:n,scaleY:r,offsetX:h,offsetY:a}=ui(s);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:c,clientY:g,identifier:w})=>{let l=s.touches[w];l||(l=s.touches[w]={start:{x:(c-h)/n,y:(g-a)/r}},s.touches.length++),l.changed=!1}),Array.from(e.changedTouches).map(({clientX:c,clientY:g,identifier:w})=>{let l=s.touches[w];l.changed=!0,l.x=s.x=(c-h)/n,l.y=s.y=(g-a)/r,oe(s,t,e),K("touchChanged",e,s.touches),t=="onUp"&&(delete s.touches[w],s.touches.length--,s.touches.length||K("touchEnd"))})):(s.x=(e.clientX-h)/n,s.y=(e.clientY-a)/r,oe(s,t,e))}function pe({radius:e=5,canvas:t=Yt()}={}){let i=tt.get(t);if(!i){let s=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:s},tt.set(t,i)}return t.addEventListener("mousedown",le),t.addEventListener("touchstart",le),t.addEventListener("mouseup",Mt),t.addEventListener("touchend",Mt),t.addEventListener("touchcancel",Mt),t.addEventListener("blur",gi),t.addEventListener("mousemove",ae),t.addEventListener("touchmove",ae),i._t||(i._t=!0,Je("tick",()=>{i._lf.length=0,i._cf.map(s=>{i._lf.push(s)}),i._cf.length=0})),i}function yi(...e){e.flat().map(t=>{let i=t.context?t.context.canvas:Yt(),s=tt.get(i);if(!s)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){s._cf.push(this),this._r()},s._o.push(t))})}function me(e,t){let i=e[0].toUpperCase()+e.substr(1);Lt["on"+i]=t}var It=class extends j{init({padX:t=0,padY:i=0,text:s,disabled:n=!1,onDown:r,onUp:h,...a}={}){super.init({padX:t,padY:i,...a}),this.textNode=it({...s,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),yi(this),this.addChild(this.textNode),this._od=r||Z,this._ou=h||Z;let d=this._dn=document.createElement("button");d.style=Ke,d.textContent=this.text,n&&this.disable(),d.addEventListener("focus",()=>this.focus()),d.addEventListener("blur",()=>this.blur()),d.addEventListener("keydown",c=>this._kd(c)),d.addEventListener("keyup",c=>this._ku(c)),je(d,this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+this.padX*2,i=this.textNode.height+this.padY*2;this.width=Math.max(t,this.width),this.height=Math.max(i,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){(t.code=="Enter"||t.code=="Space")&&this.onDown()}_ku(t){(t.code=="Enter"||t.code=="Space")&&this.onUp()}};function yt(){return new It(...arguments)}function wi(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function _e({fps:e=60,clearCanvas:t=!0,update:i=Z,render:s,context:n=ut(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let h=0,a=1e3/e,d=1/e,c=t?wi:Z,g,w,l,f,C,b=!0;r||(window.addEventListener("focus",()=>{b=!0}),window.addEventListener("blur",()=>{b=!1}));function _(){if(w=requestAnimationFrame(_),!!b&&(l=performance.now(),f=l-g,g=l,!(f>1e3))){for(K("tick"),h+=f;h>=a;)C.update(d),h-=a;c(n),C.render()}}return C={update:i,render:s,isStopped:!0,start(){g=performance.now(),this.isStopped=!1,requestAnimationFrame(_)},stop(){this.isStopped=!0,cancelAnimationFrame(w)},_frame:_,set _last(E){g=E}},C}function xi(e){if(+e==e)return e;let t=[],i=e.split(".."),s=+i[0],n=+i[1],r=s;if(s<n)for(;r<=n;r++)t.push(r);else for(;r>=n;r--)t.push(r);return t}var Rt=class{constructor({image:t,frameWidth:i,frameHeight:s,frameMargin:n,animations:r}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:s,margin:n},this._f=t.width/i|0,this.createAnimations(r)}createAnimations(t){let i,s;for(s in t){let{frames:n,frameRate:r,loop:h}=t[s];if(i=[],n==null)throw Error("Animation "+s+" must provide a frames property");[].concat(n).map(a=>{i=i.concat(xi(a))}),this.animations[s]=Ve({spriteSheet:this,frames:i,frameRate:r,loop:h})}}};function Ht(){return new Rt(...arguments)}var pi=function(){let e=function(l){return Math.sin(l*6.283184)},t=function(l){return 2*(l%1)-1},i=function(l){return l%1<.5?1:-1},s=function(l){let f=l%1*4;return f<2?f-1:3-f},n=function(l){return .003959503758*2**((l-128)/12)},r=function(l,f,C){let b=h[l.i[0]],_=l.i[1],E=l.i[3]/32,k=h[l.i[4]],Y=l.i[5],m=l.i[8]/32,y=l.i[9],S=l.i[10]*l.i[10]*4,z=l.i[11]*l.i[11]*4,J=l.i[12]*l.i[12]*4,u=1/J,B=-l.i[13]/16,L=l.i[14],ee=C*2**(2-l.i[15]),X=new Int32Array(S+z+J),x=0,T=0,P,H,M,dt,O,nt,F;for(P=0,H=0;P<S+z+J;P++,H++)H>=0&&(L=L>>8|(L&255)<<4,H-=ee,nt=n(f+(L&15)+l.i[2]-128),F=n(f+(L&15)+l.i[6]-128)*(1+8e-4*l.i[7])),M=1,P<S?M=P/S:P>=S+z&&(M=(P-S-z)*u,M=(1-M)*3**(B*M)),x+=nt*M**E,O=b(x)*_,T+=F*M**m,O+=k(T)*Y,y&&(O+=(2*Math.random()-1)*y),X[P]=80*O*M|0;return X},h=[e,i,t,s],a,d,c,g,w;this.init=function(l){a=l,d=l.endPattern,c=0,g=l.rowLen*l.patternLen*(d+1)*2,w=new Int32Array(g)},this.generate=function(){let l,f,C,b,_,E,k,Y,m,y,S,z,J,u,B,L,ee,X=new Int32Array(g),x=a.songData[c],T=a.rowLen,P=a.patternLen,H=0,M=0,dt,O,nt=!1,F=[];if(x)for(b=0;b<=d;++b)for(Y=x.p[b],_=0;_<P;++_){let Ct=Y?x.c[Y-1].f[_]:0;Ct&&(x.i[Ct-1]=x.c[Y-1].f[_+P]||0,Ct<17&&(F=[]));let De=h[x.i[16]],He=x.i[17]/512,We=2**(x.i[18]-9)/T,Ue=x.i[19],ie=x.i[20],$e=x.i[21]*43.23529*3.141592/44100,Ne=1-x.i[22]/255,kt=x.i[23]*1e-5,ze=x.i[24]/32,Fe=x.i[25]/512,qe=6.283184*2**(x.i[26]-9)/T,se=x.i[27]/255,St=x.i[28]*T&-2;for(B=(b*P+_)*T,E=0;E<4;++E)if(k=Y?x.c[Y-1].n[_+E*P]:0,k){F[k]||(F[k]=r(x,k,T));let ne=F[k];for(f=0,l=B*2;f<ne.length;f++,l+=2)X[l]+=ne[f]}for(f=0;f<T;f++)m=(B+f)*2,u=X[m],u||nt?(L=$e,Ue&&(L*=De(We*m)*He+.5),L=1.5*Math.sin(L),H+=L*M,dt=Ne*(u-M)-H,M+=L*dt,u=ie==3?M:ie==1?dt:H,kt&&(u*=kt,u=u<1?u>-1?e(u*.25):-1:1,u/=kt),u*=ze,nt=u*u>1e-5,y=Math.sin(qe*m)*Fe+.5,O=u*(1-y),u*=y):O=0,m>=St&&(O+=X[m-St+1]*se,u+=X[m-St]*se),X[m]=O|0,X[m+1]=u|0,w[m]+=O|0,w[m+1]+=u|0}return c++,c/a.numChannels},this.createWave=function(){let l=44,f=l+g*2-8,C=f-36,b=new Uint8Array(l+g*2);b.set([82,73,70,70,f&255,f>>8&255,f>>16&255,f>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,C&255,C>>8&255,C>>16&255,C>>24&255]);for(let _=0,E=l;_<g;++_){let k=w[_];k=k<-32767?-32767:k>32767?32767:k,b[E++]=k&255,b[E++]=k>>8&255}return b}},wt=pi;var be={songData:[{i:[1,75,140,0,1,105,128,3,0,0,92,0,95,0,0,0,3,31,5,1,2,124,135,11,32,150,3,157,6],p:[1],c:[{n:[135,137,139,144,144,135,137,139,142,142,135,137,139,140,140,135,137,139,135],f:[]}]}],rowLen:11025,patternLen:21,endPattern:0,numChannels:1},ve={songData:[{i:[3,255,128,0,0,255,140,0,0,127,2,2,47,61,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[1],c:[{n:[147],f:[]}]}],rowLen:11025,patternLen:1,endPattern:0,numChannels:1},Ce={songData:[{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1],c:[{n:[147],f:[]}]}],rowLen:11025,patternLen:1,endPattern:0,numChannels:1};function D(e){return Math.floor(Math.random()*e)}function xt(e){let t,i=0,s=Math.random();for(t in e)if(i+=e[t],s<=i)return t}de();pe();ge("assets/img/");var mt=!1,lt=0,Nt=new wt,zt=new wt,Ft=new wt;Nt.init(be);zt.init(ve);Ft.init(Ce);var ke,Se,Ae,at=document.createElement("audio"),Re=document.createElement("audio"),Ye=document.createElement("audio"),Me=!1,Ee=!1,Pe=!1,R=parseInt(localStorage.getItem("dsShieldHistory"))?parseInt(localStorage.getItem("dsShieldHistory")):0,Wt=parseInt(localStorage.getItem("dsHighScore"))?parseInt(localStorage.getItem("dsHighScore")):0,mi=setInterval(function(){Me&&(console.log("BGM ready"),ke=Nt.createWave(),at.src=URL.createObjectURL(new Blob([ke],{type:"audio/wav"})),at.loop=!0,clearInterval(mi)),Me=Nt.generate()>=1}),_i=setInterval(function(){Ee&&(Se=zt.createWave(),Re.src=URL.createObjectURL(new Blob([Se],{type:"audio/wav"})),clearInterval(_i)),Ee=zt.generate()>=1}),bi=setInterval(function(){Pe&&(Ae=Ft.createWave(),Ye.src=URL.createObjectURL(new Blob([Ae],{type:"audio/wav"})),clearInterval(bi)),Pe=Ft.generate()>=1}),vi=it({text:"Death RIPper",font:"36px Aerial",color:"white",x:320,y:30,anchor:{x:.5,y:.5},textAlign:"center"}),Ci=it({text:`The job of death is boring yet vital. If they did not banish the decreased from earth,
 they will turn into spectres and harm the world. Your time is limited.
Send those poor souls to hell while avoiding spectres.
The peace of the world is upon you.



When the human is dying, a counter will appear over them. 
When the counter turns to 0, they will turn into spectres.

Approach them before the counter runs out. You cannot lay hands on the livings.

Click on the Map to move. You will stop once bump into anything except the dyings.

If you are hit by spectres, a shield will be broken and
you will be sent back to hell if you are hit by spectres without any shield.

You will also be sent back to hell if your time on earth runs out.
Collect more souls from the dyings to extend your time.`,font:"15px Aerial",color:"white",x:320,y:100,anchor:{x:.5,y:0},textAlign:"center"}),ki=yt({x:320,y:500,anchor:{x:.5,y:.5},text:{text:"Start Game",color:"white",font:"24px sans-serif",anchor:{x:.5,y:.5}},padX:20,padY:10,render(){this.focused&&(this.context.setLineDash([8,10]),this.context.lineWidth=3,this.context.strokeStyle="red",this.context.strokeRect(0,0,this.width,this.height)),this.pressed?(this.textNode.color="yellow",at.play(),Te(),console.log("SAS"),lt=1,this.pressed=!1):this.hovered?this.textNode.color="red":this.textNode.color="white"}}),Si=yt({x:300,y:150,anchor:{x:.5,y:.5},text:{text:"You are sent back to hell",color:"red",font:"30px sans-serif",anchor:{x:.5,y:.5}},padX:20,padY:10}),Ut=it({text:"",font:"18px Aerial",color:"white",x:300,y:250,anchor:{x:.5,y:.5},textAlign:"center"}),Oe=yt({x:300,y:350,anchor:{x:.5,y:.5},padX:10,padY:10,onDown(){lt=0,at.pause(),at.currentTime=0,console.log("RE")}});et("replayBut.png").then(()=>{Oe.image=A.replayBut});var $=G({x:5,y:5,anchor:{x:0,y:0},height:20,width:300,color:"Aqua"}),pt=0,Ge=[];et("shield.png").then(()=>{for(let e=0;e<6;e++){let t=G({x:5+e*20,y:30,anchor:{x:0,y:0},height:15,width:15,image:A.shield});Ge.push(t)}});var Be=G({x:0,y:50,anchor:{x:0,y:0},height:480,width:640});et("ground.png").then(()=>{Be.image=A.ground});et("tree.png").then(()=>{});var Le,qt=new Image;qt.src="assets/img/death.png";qt.onload=function(){Le=Ht({image:qt,frameWidth:20,frameHeight:20,animations:{strike:{frames:"0..2",frameRate:9}}}),o=new bt({x:400,y:320,width:20,height:20,anchor:{x:.5,y:.5},shield:Math.floor(R/20)+1,point:0,animations:Le.animations})};var Xe,Kt=new Image;Kt.src="assets/img/human.png";Kt.onload=function(){Xe=Ht({image:Kt,frameWidth:20,frameHeight:20,animations:{die:{frames:"0..2",frameRate:60}}})};var jt=class extends U{constructor(t){t.anchor={x:0,y:0},t.color="#CD853F",super(t)}draw(){this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height)}},st=[],Ai=[[0,50,10,295],[0,50,215,10],[0,520,10,295],[0,315,215,10],[345,50,10,295],[630,50,215,10],[345,520,10,295],[630,315,215,10]];Ai.forEach(e=>{st.push(new jt({x:e[0],y:e[1],height:e[2],width:e[3]}))});var Qt=class extends U{constructor(t){super(t)}},ot=[],Mi=[[295,50,10,50,320,490],[0,265,50,10,600,290],[295,520,10,50,320,90],[630,265,50,10,40,290]];Mi.forEach(e=>{ot.push(new Qt({x:e[0],y:e[1],height:e[2],width:e[3],anchor:{x:0,y:0},sx:e[4],sy:e[5]}))});var bt=class extends j{constructor(t){super(t)}draw(){super.draw()}},o,vt;et("pointer.png").then(()=>{vt=new bt({x:400,y:320,width:10,height:10,anchor:{x:.5,y:.5},image:A.pointer})});var Jt=class extends U{constructor(t){switch(super(t),D(3)){case 0:let s={x:-t.width/2,y:-t.height/2},n={x:t.width/2-25,y:-t.height/2},r={x:-t.width/2,y:t.height/2-25},h=null,a=null,d=D(4);switch(d){case 0:h=s,a=r;break;case 1:h=n,a=r;break;case 2:h=n,a=s;break;case 3:h=s,a=s;break;default:console.log("Some error occurred")}for(let y=0;y<5;y++){let S=G({x:h.x,y:h.y+y*25,width:25,height:25,anchor:{x:0,y:0},image:A.tree});this.addChild(S)}for(let y=0;y<5;y++){let S=G({x:a.x+y*25,y:a.y,width:25,height:25,anchor:{x:0,y:0},image:A.tree});this.addChild(S)}let c={x:t.x-t.width/2,y:t.y-t.height/2},g={x:t.x+t.width/2,y:t.y-t.height/2},w={x:t.x-t.width/2,y:t.y+t.height/2},l={x:t.x+t.width/2,y:t.y+t.height/2};switch(d){case 0:this.lines=[{pt1:c,pt2:w},{pt1:w,pt2:l}];break;case 1:this.lines=[{pt1:g,pt2:l},{pt1:w,pt2:l}];break;case 2:this.lines=[{pt1:c,pt2:g},{pt1:g,pt2:l}];break;case 3:this.lines=[{pt1:c,pt2:w},{pt1:c,pt2:g}];break;default:console.log("Some error occurred")}break;case 1:let f={x:-t.width/2,y:-25/2},C={x:-25/2,y:-t.width/2};for(let y=0;y<5;y++){let S=G({x:f.x+y*25,y:f.y,width:25,height:25,anchor:{x:0,y:0},image:A.tree});this.addChild(S)}for(let y=0;y<5;y++){let S=G({x:C.x,y:C.y+y*25,width:25,height:25,anchor:{x:0,y:0},image:A.tree});this.addChild(S)}let b={x:t.x,y:t.y-t.height/2},_={x:t.x,y:t.y+t.height/2},E={x:t.x-t.width/2,y:t.y},k={x:t.x+t.width/2,y:t.y};this.lines=[{pt1:b,pt2:_},{pt1:E,pt2:k}];break;case 2:let Y=D(2),m=D(5);switch(Y){case 0:for(let u=0;u<5;u++){let B=G({x:-t.width/2+u*25,y:(m-2)*25-12.5,width:25,height:25,anchor:{x:0,y:0},image:A.tree});this.addChild(B)}let y={x:t.x-t.width/2,y:t.y+(m-2)*25},S={x:t.x+t.width/2,y:t.y+(m-2)*25};this.lines=[{pt1:y,pt2:S}];break;case 1:for(let u=0;u<5;u++){let B=G({x:(m-2)*25-12.5,y:-t.height/2+u*25,width:25,height:25,anchor:{x:0,y:0},image:A.tree});this.addChild(B)}let z={x:t.x+(m-2)*25,y:t.y-t.height/2},J={x:t.x+(m-2)*25,y:t.y+t.height/2};this.lines=[{pt1:z,pt2:J}];break;default:console.log("Some line error occurred")}break;default:console.log("Some type error occurred")}}cast(t,i){for(let s of this.lines){let n=s.pt1.x,r=s.pt1.y,h=s.pt2.x,a=s.pt2.y,d=t.x,c=t.y,g=i.x,w=i.y,l=(n-h)*(c-w)-(r-a)*(d-g);if(l==0)continue;let f=((n-d)*(c-w)-(r-c)*(d-g))/l,C=-((n-h)*(r-c)-(r-a)*(n-d))/l;if(f>0&&f<1&&C>0)return!0}return!1}},Vt=class extends j{constructor(t){super(t),this.lifeCount=(10+D(5))*60,this.state=3,this.repelX=0,this.repelY=0,this.lCounter=it({text:"",font:"18px Aerial",color:"white",x:0,y:0,anchor:{x:.5,y:.5},textAlign:"center"})}check(){let t=!1;for(let i of N)if(i.cast(this,o)&&i.cast(o,this)){t=!0;break}if(!t){let[i,s]=_t(this,o,1),n=!1;for(let h of N)if(this.x-=i,p(this,h)){for(let a of h.children)if(p(this,a)){this.x+=i,n=!0;break}}else this.x+=i;let r=!1;for(let h of N)if(this.y-=s,p(this,h)){for(let a of h.children)if(p(this,a)){this.y+=s,r=!0;break}}else this.y+=s;for(let h of st)if(this.x-=i,p(this,h)){this.x+=i,n=!0;break}else this.x+=i;for(let h of st)if(this.y-=s,p(this,h)){this.y+=s,r=!0;break}else this.y+=s;for(let h of ot)if(this.x-=i,p(this,h)){this.x+=i,n=!0;break}else this.x+=i;for(let h of ot)if(this.y-=s,p(this,h)){this.y+=s,r=!0;break}else this.y+=s;for(let h of v)if(h.indx!=this.indx)if(this.x-=i,p(this,h)&&h.state!=0){this.x+=i,n=!0;break}else this.x+=i;for(let h of v)if(h.indx!=this.indx)if(this.y-=s,p(this,h)&&h.state!=0){this.y+=s,r=!0;break}else this.y+=s;n||(this.x-=i),r||(this.y-=s)}}stateChange(){if(Math.floor(this.lifeCount/60)<11)return Math.floor(this.lifeCount/60)<1?(this.state==1&&this.update(),this.state=0):Math.floor(this.lifeCount/60)<6?this.state==2&&(this.update(),this.state=1):this.state=2,!0}chase(){if(this.repelX||this.repelY){let t={x:this.repelX,y:this.repelY},[i,s]=_t(this,t,2);this.x!=this.repelX||this.y!=this.repelY?(this.x+=i,this.y+=s):(this.repelX=0,this.repelY=0)}else{let t={x:o.x,y:o.y},[i,s]=_t(this,t,2);(this.x!=t.x||this.y!=t.y)&&(this.x+=i,this.y+=s),p(this,o)&&(o.shield?(Re.play(),this.repelX=this.x-i*40,this.repelY=this.y-s*40,o.shield-=1,o.shield==0&&(o.opacity=.4)):(mt=!0,console.log("Loser")))}}draw(){super.draw()}},Ei=[[100,150],[115,440],[335,165],[320,390],[540,140],[515,350]],N=[],v=[];function Te(){N.length=0,v.length=0,Ei.forEach(i=>{N.push(new Jt({x:i[0],y:i[1],width:125,height:125,anchor:{x:.5,y:.5}}))});let e={x:0,y:0},t=0;for(;t<5;){let i={x:0,y:0},s=!0;if(e.x<=320){let r=Math.floor((620-e.x)/4);i.x=e.x+xt({4:.4,3:.3,2:.2,1:.1})*r-D(r)}else{let r=Math.floor((e.x-20)/4);i.x=e.x-xt({4:.4,3:.3,2:.2,1:.1})*r+D(r)}if(e.y<=265){let r=Math.floor((460-e.y)/4);i.y=e.y+xt({4:.4,3:.3,2:.2,1:.1})*r-D(r)}else{let r=Math.floor((e.y-20)/4);i.y=e.y-xt({4:.4,3:.3,2:.2,1:.1})*r+D(r)}e.x*=t,e.y*=t,e.x+=i.x,e.y+=i.y,e.x/=t+1,e.y/=t+1;let n=new Vt({x:i.x,y:i.y+50,width:20,height:20,anchor:{x:.5,y:.5},indx:t,animations:Xe.animations});if(p(n,o)&&(s=!1),s){for(let r of N)if(p(n,r)){for(let h of r.children)if(p(n,h)){s=!1;break}}}if(s){for(let r of st)if(p(n,r)){s=!1;break}}if(s){for(let r of ot)if(p(n,r)){s=!1;break}}s&&(v.push(n),t+=1,console.log(e.x,e.y),console.log(n.x,n.y))}}function _t(e,t,i){let s=t.y-e.y;s>0?s=s>=i?i:s:s<0&&(s=s<=i?-i:s);let n=t.x-e.x;return n>0?n=n>=i?i:n:n<0&&(n=n<=i?-i:n),[Math.floor(n),Math.floor(s)]}var Zt=0,te=0,Q=!1;me("down",function(e,t){lt==1&&(Q=!0,Zt=Ie.x,te=Ie.y,vt.x=Zt,vt.y=te)});var $t=0,Ie=xe(),Pi=_e({update:function(){if(Q){let e={x:Zt,y:te},[t,i]=_t(o,e,3),s=!1;o.x!=e.x||o.y!=e.y?(o.x+=t,o.y+=i):Q=!1;for(let n of N)if(p(o,n)){for(let r of n.children)if(p(o,r)){s=!0;break}}for(let n of st)if(p(o,n)){s=!0;break}for(let n=v.length-1;n>=0;n--)p(o,v[n])&&(v[n].stateChange()?v[n].state&&(Ye.play(),o.point+=1,o.point%5==0&&($.width+=200,$.width=$.width>600?600:$.width),v.splice(n,1),$t=20):s=!0);mt&&(lt=2,v.length=0,o.x=400,o.y=320,(R<100||!R)&&(R+o.point<100?(Math.floor((R+o.point)/20)-Math.floor(R/20)&&console.log("New shield"),R=R+o.point):(console.log("New shield"),R=100),localStorage.setItem("dsShieldHistory",R)),o.shield=Math.floor(R/20)+1,o.opacity=1,Ut.text="Score: "+String(o.point),(o.point>Wt||!Wt)&&(console.log("New High Score"),Ut.text+="   New High Score!",Wt=o.point,localStorage.setItem("dsHighScore",o.point)),o.point=0,$.width=300,pt=0,mt=!1,Q=!1);for(let n of ot)if(p(o,n)){console.log("Exited"),o.x=n.sx,o.y=n.sy,Q=!1,Te();break}s&&(Q=!1,o.x-=t,o.y-=i)}$t&&(o.update(),$t-=1);for(let e=v.length-1;e>=0;e--)v[e].stateChange()&&(v[e].state?v[e].check():v[e].chase()),v[e].lifeCount>0&&(v[e].lifeCount-=1)},render:function(){switch(lt){case 0:vi.render(),Ci.render(),ki.render();break;case 1:Be.render(),pt<=2?pt++:(pt=0,$.width>0?$.width-=1:mt=!0),$.render();for(let e=1;e<=o.shield;e++)Ge[e-1].render();for(let e of st)e.render();for(let e of N)e.render();for(let e of v)e.render(),e.state<3&&(e.lCounter.x=e.x+15,e.lCounter.y=e.y-15,e.lCounter.text=Math.floor(e.lifeCount/60),e.lCounter.render());Q&&vt.render(),o.render();break;case 2:Si.render(),Oe.render(),Ut.render();break;default:console.log("Error")}}});Pi.start();})();
